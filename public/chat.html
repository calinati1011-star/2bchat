<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Chat</title>
<link rel="stylesheet" href="style.css">
<<<<<<< HEAD
</head>
<body class="bg">
<div class="chatBox glass">
<h2 id="title"></h2>
<div id="chat"></div>
<div class="send">
<input id="msg" placeholder="Scrivi...">
<button onclick="send()">âž¤</button>
</div>
</div>
<script>
const room=new URLSearchParams(location.search).get("room");
const user=localStorage.getItem("username");
title.innerText=room=="fun"?"ðŸŽ‰ Chat Divertimento":"ðŸ“š Chat Studio";

async function load(){
 const r=await fetch("/api/messages/"+room);
 const d=await r.json();
 chat.innerHTML="";
 d.forEach(m=>{
  chat.innerHTML+=`<div class="msg"><b>${m.username}</b><span>${m.timestamp}</span><p>${m.text}</p></div>`;
 });
 chat.scrollTop=chat.scrollHeight;
}
async function send(){
 if(!msg.value)return;
 await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({room,username:user,text:msg.value,timestamp:new Date().toLocaleString()})});
 msg.value=""; load();
}
setInterval(load,1500); load();
=======
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="layout">
<div class="sidebar">
<h3>Online</h3>
<ul id="users"></ul>
</div>
<div class="chatbox">
<div id="messages"></div>
<div class="input">
<input id="msg" placeholder="Messaggio">
<input type="file" id="img">
<button onclick="send()">Invia</button>
</div>
</div>
</div>
<script>
const room=new URLSearchParams(location.search).get("room")
const user=localStorage.getItem("user")
const s=io()
s.emit("join",{room,user})

s.on("users",u=>{
users.innerHTML=""
u.forEach(n=>users.innerHTML+=`<li onclick="kick('${n}')">${n}</li>`)
})

s.on("history",h=>h.forEach(add))
s.on("msg",add)
s.on("system",t=>messages.innerHTML+=`<div class='sys'>${t}</div>`)

function add(m){
messages.innerHTML+=m.type=="img"
?`<div class='msg'><b>${m.user}</b><br><img src="${m.content}"></div>`
:`<div class='msg'><b>${m.user}</b> ${m.content}</div>`
messages.scrollTop=messages.scrollHeight
}

async function send(){
if(img.files[0]){
const fd=new FormData()
fd.append("image",img.files[0])
const r=await fetch("/upload",{method:"POST",body:fd})
const d=await r.json()
s.emit("msg",{room,user,type:"img",content:d.path})
img.value=""
}else if(msg.value){
s.emit("msg",{room,user,type:"text",content:msg.value})
msg.value=""
}
}

function kick(u){
if(confirm("Votare kick "+u+"?"))s.emit("votekick",u)
}
>>>>>>> e9de0cd (Initial commit - 2B Community Chat)
</script>
</body>
</html>